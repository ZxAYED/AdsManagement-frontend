import { motion } from "framer-motion";
import { ChevronDown, CreditCard } from "lucide-react";
import { AnimatePresence } from "motion/react";
import { useState } from "react";
import { PaymentMethod } from ".";
import img from "../../../../../assets/Dashboard/master.png";
import img2 from "../../../../../assets/Dashboard/paypal.svg";
interface PaymentMethodSelectorProps {
  paymentMethods: PaymentMethod[];
  selectedMethodId: string;
  onMethodChange: (methodId: string) => void;
}

export function PaymentMethodSelector({
  paymentMethods,
  selectedMethodId,
  onMethodChange,
}: PaymentMethodSelectorProps) {
  const [isOpen, setIsOpen] = useState(false);
  const selectedMethod = paymentMethods.find(
    (method) => method.id === selectedMethodId
  );

  const getCardIcon = (type: string) => {
    switch (type) {
      case "mastercard":
        return (
          <div className="w-20 h-10  rounded flex items-center justify-center">
            <img
              src={img}
              alt="MasterCard"
              className="w-full h-full object-cover"
            />
          </div>
        );
      case "visa":
        return (
          <div className="w-20 h-10  rounded flex items-center justify-center">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="60"
              height="80"
              viewBox="0 0 39 26"
              fill="none"
            >
              <g clip-path="url(#clip0_550_951)">
                <path
                  d="M39.0006 1.68757V24.3176C38.7248 25.0879 38.2311 25.5 37.3782 25.499C25.4551 25.4886 13.5319 25.4928 1.60883 25.4917C0.566553 25.4917 0.00266299 24.9212 0.00266299 23.8714C0.000627291 16.6248 0.000627291 9.37932 0.00164514 2.13278C0.00164514 1.97851 0.00368084 1.82113 0.0352342 1.671C0.197073 0.910009 0.751802 0.513463 1.64548 0.513463C13.48 0.512427 25.3146 0.518639 37.1492 0.500003C38.0662 0.498967 38.6993 0.781623 39.0006 1.68757ZM25.7624 18.2814C26.6917 18.2814 27.5651 18.2876 28.4384 18.2711C28.5229 18.269 28.6409 18.1416 28.6806 18.0454C28.8272 17.6892 28.9371 17.3185 29.0827 16.9624C29.1224 16.8661 29.2404 16.7356 29.3239 16.7346C30.4008 16.719 31.4777 16.7242 32.5698 16.7242C32.6604 17.1674 32.7358 17.5836 32.8345 17.9936C32.8599 18.0982 32.9576 18.2659 33.0258 18.2669C33.8065 18.2866 34.5872 18.2793 35.3791 18.2793C35.3628 18.1385 35.3608 18.0474 35.3425 17.9594C34.6595 14.6328 33.9724 11.3061 33.2956 7.97847C33.2508 7.75793 33.1459 7.71859 32.9566 7.72066C32.3602 7.72791 31.7637 7.72273 31.1672 7.72377C30.3306 7.72377 30.014 7.93602 29.6893 8.726C28.4903 11.6364 27.2933 14.5468 26.0963 17.4573C25.9904 17.7151 25.8866 17.9749 25.7635 18.2814H25.7624ZM7.63146 18.2825C8.47729 18.2825 9.30074 18.2669 10.1232 18.2907C10.4163 18.299 10.5395 18.1893 10.6463 17.9273C11.8606 14.9548 13.0871 11.9884 14.3096 9.01901C14.4796 8.60694 14.6434 8.19175 14.8328 7.72377C13.9676 7.72377 13.1594 7.73412 12.3512 7.71755C12.0856 7.71238 11.9533 7.78796 11.8555 8.05405C11.4413 9.17432 10.9995 10.2842 10.5659 11.3973C10.1333 12.5072 9.69872 13.616 9.2244 14.8305C9.10633 14.2062 9.00963 13.6906 8.91294 13.1739C8.63811 11.7079 8.37551 10.2387 8.08237 8.7757C7.95412 8.13481 7.50423 7.73619 6.92914 7.73101C5.45733 7.71652 3.98552 7.72066 2.5137 7.73309C2.40785 7.73309 2.30199 7.86354 2.19715 7.93395C2.21445 7.97122 2.23074 8.00953 2.24804 8.0468C2.3427 8.07476 2.43736 8.10064 2.52999 8.1317C3.2262 8.36362 3.92546 8.58623 4.6176 8.83265C5.09396 9.00141 5.36878 9.34412 5.49295 9.85973C5.87567 11.4459 6.29197 13.0249 6.69504 14.6069C7.00548 15.8245 7.31694 17.0421 7.6335 18.2835L7.63146 18.2825ZM26.423 8.01988C25.6647 7.69271 24.8952 7.5519 24.1084 7.53429C22.8259 7.50634 21.6005 7.72998 20.5694 8.57277C19.6665 9.31099 19.2207 10.2697 19.407 11.4646C19.5566 12.4295 20.2111 13.0166 20.9775 13.4908C21.4854 13.8055 22.0229 14.0695 22.5328 14.3812C22.884 14.5955 23.1608 14.8875 23.0672 15.3575C22.9796 15.7945 22.6448 16.0326 22.2631 16.0782C21.6666 16.1506 21.0488 16.1941 20.4574 16.1154C19.8793 16.0388 19.3235 15.7924 18.7301 15.6122C18.6039 16.2159 18.5021 16.8526 18.3301 17.4687C18.2242 17.8486 18.3606 17.9563 18.6813 18.0578C19.7754 18.4026 20.893 18.5133 22.0249 18.415C22.9562 18.3342 23.8357 18.0588 24.6113 17.4935C26.0871 16.4198 26.6704 13.7827 24.5247 12.4564C24.2754 12.3022 24.024 12.1541 23.7715 12.005C23.3776 11.7721 22.9634 11.5691 22.5939 11.302C21.9791 10.8578 22.0432 10.2045 22.7578 9.9612C23.2097 9.80693 23.7298 9.76551 24.2082 9.80693C24.7904 9.85766 25.3604 10.0482 25.966 10.1848C26.1146 9.48182 26.2673 8.75706 26.423 8.01885V8.01988ZM18.667 7.72377C17.8456 7.72377 17.0731 7.73516 16.3025 7.71755C16.0409 7.71134 15.9361 7.77968 15.8781 8.05819C15.3152 10.7895 14.733 13.5177 14.1569 16.2469C14.0175 16.9096 13.8821 17.5732 13.7406 18.2586H16.4491C17.186 14.757 17.9189 11.274 18.666 7.72377H18.667Z"
                  fill="#2A2D6B"
                />
                <path
                  d="M25.7618 18.2815C25.8859 17.9751 25.9887 17.7152 26.0946 17.4574C27.2916 14.547 28.4886 11.6365 29.6876 8.72612C30.0133 7.93614 30.3289 7.72388 31.1655 7.72388C31.762 7.72388 32.3585 7.72906 32.9549 7.72078C33.1442 7.71871 33.2491 7.75805 33.2939 7.97859C33.9707 11.3063 34.6578 14.6329 35.3408 17.9595C35.3591 18.0475 35.3621 18.1376 35.3774 18.2795C34.5845 18.2795 33.8038 18.2867 33.0241 18.267C32.9559 18.265 32.8582 18.0983 32.8328 17.9937C32.734 17.5837 32.6577 17.1675 32.5681 16.7243C31.476 16.7243 30.3991 16.7192 29.3222 16.7347C29.2387 16.7357 29.1207 16.8662 29.081 16.9625C28.9344 17.3186 28.8245 17.6903 28.6789 18.0455C28.6392 18.1418 28.5212 18.2691 28.4367 18.2712C27.5634 18.2877 26.69 18.2815 25.7607 18.2815H25.7618ZM31.3569 10.8062C31.3274 10.8051 31.2979 10.8041 31.2683 10.8031C30.8327 12.0279 30.396 13.2528 29.9492 14.5087H32.1091C31.8536 13.2538 31.6052 12.03 31.3569 10.8062Z"
                  fill="white"
                />
                <path
                  d="M7.63068 18.283C7.31413 17.0416 7.00267 15.824 6.69222 14.6064C6.28915 13.0243 5.87285 11.4464 5.49014 9.85922C5.36596 9.34361 5.09012 9.0009 4.61479 8.83213C3.92367 8.58572 3.22338 8.36311 2.52717 8.13119C2.43353 8.10013 2.33887 8.07424 2.24523 8.04629C2.22793 8.00902 2.21164 7.97071 2.19434 7.93343C2.30019 7.86406 2.40503 7.73361 2.51089 7.73257C3.9827 7.72015 5.45451 7.71497 6.92633 7.7305C7.50141 7.73671 7.9513 8.13533 8.07955 8.77519C8.37269 10.2382 8.6353 11.7074 8.91012 13.1734C9.00682 13.689 9.10453 14.2057 9.22158 14.83C9.6959 13.6155 10.1305 12.5067 10.5631 11.3967C10.9967 10.2837 11.4385 9.17381 11.8527 8.05354C11.9515 7.78745 12.0828 7.71187 12.3484 7.71704C13.1566 7.73361 13.9648 7.72326 14.8299 7.72326C14.6416 8.19124 14.4768 8.60642 14.3068 9.0185C13.0843 11.9869 11.8578 14.9543 10.6435 17.9268C10.5366 18.1877 10.4145 18.2985 10.1203 18.2902C9.29792 18.2664 8.47448 18.2819 7.62865 18.2819L7.63068 18.283Z"
                  fill="white"
                />
                <path
                  d="M26.4223 8.02003C26.2666 8.75824 26.1139 9.483 25.9653 10.186C25.3597 10.0493 24.7897 9.85884 24.2075 9.80811C23.7291 9.76669 23.21 9.80811 22.757 9.96238C22.0425 10.2057 21.9784 10.859 22.5932 11.3032C22.9626 11.5703 23.3779 11.7732 23.7708 12.0062C24.0222 12.1553 24.2747 12.3044 24.524 12.4576C26.6697 13.7839 26.0864 16.421 24.6105 17.4947C23.8339 18.06 22.9555 18.3344 22.0242 18.4162C20.8923 18.5145 19.7737 18.4037 18.6805 18.059C18.3589 17.9575 18.2235 17.8498 18.3294 17.4698C18.5004 16.8528 18.6032 16.217 18.7294 15.6134C19.3228 15.7936 19.8786 16.039 20.4567 16.1166C21.0481 16.1953 21.6659 16.1518 22.2624 16.0793C22.6441 16.0327 22.9789 15.7956 23.0665 15.3587C23.1611 14.8887 22.8833 14.5967 22.5321 14.3824C22.0222 14.0707 21.4847 13.8067 20.9768 13.4919C20.2104 13.0177 19.5569 12.4307 19.4063 11.4657C19.221 10.2709 19.6658 9.31217 20.5687 8.57395C21.5997 7.73116 22.8252 7.50752 24.1077 7.53547C24.8945 7.55204 25.664 7.69388 26.4223 8.02106V8.02003Z"
                  fill="white"
                />
                <path
                  d="M18.6666 7.72339C17.9195 11.2737 17.1866 14.7566 16.4497 18.2583H13.7412C13.8827 17.5728 14.0181 16.9092 14.1575 16.2465C14.7326 13.5173 15.3148 10.7891 15.8787 8.05781C15.9357 7.7793 16.0416 7.71096 16.3031 7.71718C17.0747 7.73374 17.8462 7.72339 18.6676 7.72339H18.6666Z"
                  fill="white"
                />
              </g>
              <defs>
                <clipPath id="clip0_550_951">
                  <rect
                    width="39"
                    height="25"
                    fill="white"
                    transform="translate(0 0.5)"
                  />
                </clipPath>
              </defs>
            </svg>
          </div>
        );
      case "paypal":
        return (
          <div className="w-20 h-10  rounded flex items-center justify-center">
            <img
              src={img2}
              alt="MasterCard"
              className="w-full h-full object-cover"
            />
          </div>
        );
      case "amex":
        return (
          <div className="w-20 h-10 bg-green-600 rounded flex items-center justify-center">
            <span className="text-white text-xs font-bold">AX</span>
          </div>
        );
      default:
        return <CreditCard size={20} className="text-title-color" />;
    }
  };

  return (
    <div className="space-y-4  mt-12 md:my-20">
      <div
        onClick={() => setIsOpen(!isOpen)}
        className="bg-dashboard-card-bg rounded-lg p-6 border 
        border-dashboard-border cursor-pointer"
      >
        <div className="flex items-center mb-6 justify-between">
          <h3 className="text-white text-2xl md:text-4xl font-medium">
            Payment Method
          </h3>
          <button className="text-title-color hover:text-white transition-colors">
            <ChevronDown
              size={20}
              className={`transform transition-transform ${
                isOpen ? "rotate-180" : ""
              }`}
            />
          </button>
        </div>

        <div className="flex items-center justify-between">
          <div className="flex items-center gap-4">
            {selectedMethod && getCardIcon(selectedMethod.type)}
            <div>
              <div className="text-white font-medium">
                {selectedMethod?.type === "mastercard"
                  ? "MasterCard"
                  : selectedMethod?.type === "visa"
                  ? "Visa"
                  : "American Express"}{" "}
                • {selectedMethod?.lastFour}
              </div>
              <div className="text-title-color text-sm">
                We'll charge a backup if there's a problem with this payment
                method.
              </div>
            </div>
          </div>
        </div>

        <AnimatePresence>
          {isOpen && (
            <motion.div
              key="spendLimitSection"
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{
                opacity: 0,
                y: 20,
                transition: { duration: 0.3, ease: "easeInOut" },
              }}
              transition={{ duration: 0.3 }}
              className="mt-4 space-y-6 border-t border-dashboard-border pt-4"
            >
              {paymentMethods.map((method) => (
                <button
                  key={method.id}
                  onClick={() => {
                    onMethodChange(method.id);
                    setIsOpen(false);
                  }}
                  className={`w-full flex items-center gap-3 p-3 rounded-lg transition-colors hover:bg-[#16294E] cursor-pointer ${
                    method.id === selectedMethodId
                      ? "bg-[#16294E] border border-[#38B6FF]"
                      : ""
                  }`}
                >
                  {getCardIcon(method.type)}
                  <span className="text-white">
                    {method.type === "mastercard"
                      ? "MasterCard"
                      : method.type === "visa"
                      ? "Visa"
                      : method.type === "paypal"
                      ? "PayPal"
                      : "American Express"}{" "}
                    • {method.lastFour}
                  </span>
                </button>
              ))}
            </motion.div>
          )}
        </AnimatePresence>
      </div>
    </div>
  );
}
